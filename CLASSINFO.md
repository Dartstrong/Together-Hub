# Документация проекта

## Оглавление

- [Слой Shared](#shared)
- [Слой Domain](#domain)
- [Слой Infrastructure](#infrastructure)
- [Слой Application](#application)
- [Слой API](#api)

## Слой Shared <a name="shared"></a>

### ICommand

**Описание**: Интерфейс, представляющий команду, которая может возвращать ответ. Существует две вариации:
- `ICommand<TResponse>`: Команда, которая возвращает ответ типа `TResponse`.
- `ICommand`: Команда, которая не возвращает ответа, используя `Unit` в качестве заглушки.

### ICommandHandler

**Описание**: Интерфейс, обрабатывающий команды. Существует две вариации:
- `ICommandHandler<TCommand, TResponse>`: Обрабатывает команду типа `TCommand` и возвращает ответ типа `TResponse`.
- `ICommandHandler<TCommand>`: Обрабатывает команду типа `TCommand`, которая не возвращает ответа, используя `Unit` в качестве заглушки.

### IQuery

**Описание**: Интерфейс, представляющий запрос, который возвращает ответ типа `TResponse`.

### IQueryHandler

**Описание**: Интерфейс, обрабатывающий запрос типа `TQuery` и возвращающий ответ типа `TResponse`.

### Глобальные директивы using

**Описание**: Глобально подключает библиотеку `MediatR`, позволяя использовать её без явного указания директивы using в каждом файле.

## Слой Domain <a name="domain"></a>

### Entity&lt;T&gt;

**Описание**: Абстрактный класс, представляющий сущность с идентификатором типа `T`. Содержит свойства для идентификации и удаления сущности.

### IEntity и IEntity&lt;T&gt;

**Описание**: Интерфейсы, представляющие сущность. `IEntity<T>` расширяет `IEntity`, добавляя свойство `Id` типа `T`.

### DomainException

**Описание**: Исключение, выбрасываемое в случае ошибок, связанных с доменной логикой.

### Topic

**Описание**: Класс, представляющий тему. Содержит свойства для заголовка, даты начала события, краткого описания, типа темы и местоположения. 

**Методы**:
- `Create`: Метод для создания экземпляра темы

### CustomIdentityUser

**Описание**: Пользовательский класс идентификации, расширяющий `IdentityUser`. Содержит дополнительные свойства для полного имени и информации о пользователе.

### Location

**Описание**: Запись, представляющая местоположение с полями для страны, города и улицы. Содержит метод для создания экземпляра местоположения.

### TopicId

**Описание**: Запись, представляющая идентификатор темы. Содержит метод для создания экземпляра идентификатора темы.

### Глобальные директивы using

**Описание**: Глобально подключает пространства имен `Domain.Abstractions`, `Domain.ValueObjects` и `Domain.Exceptions`, позволяя использовать их без явного указания директивы using в каждом файле.

## Слой Infrastructure <a name="infrastructure "></a>

### TopicIdConfiguration

**Описание**: Класс конфигурации  `TopicId` который наследуется от `IEntityTypeConfiguration<Topic>`. Используется для преобразования `TopicId` в примитивное значение при сохранении в БД.

**Методы**:
- `Configure`: Обеспечивает преобразование между типом `TopicId` и примитивным типом в БД.

### TopicLocationConfiguration

**Описание**: Класс конфигурации  `TopicLocation` который наследуется от `IEntityTypeConfiguration<Topic>`. Используется для определения  как свойство `TopicLocation`  должно быть сохранено в базе данных.

**Методы**:
- `Configure`: Обеспечивает встраивание объекта `TopicLocation` в таблицу Topics.

### ApplicationDbContext

**Описание**: Класс контекста базы данных, который наследуется от `IdentityDbContext<CustomIdentityUser>`. Используется для взаимодействия с базой данных и управления сущностями.

**Методы**:
- `OnModelCreating`: Конфигурирует модель данных при создании.

### DatabaseExtension

**Описание**: Класс расширение  для `WebApplication`, которое автоматически инициализирует базу данных при запуске приложения, выполняя миграции и заполняя начальными данными.

**Методы**:
- `InitializeDatabaseAsync`: Инициализирует БД.
- `SeedData`: Заполняет `Topics` и `IdentityUsers`.
- `SeedIdentityUsersAsync`: Если в БД нет пользователей создает их из `InitialDataIdentityUsers`.
- `SeedTopicsAsync`: Если в БД нет топиков добавляет их из `InitialData.Topics`.

### InitialData

**Описание**: Класс, определяющий начальные данные, использующийся для заполнения базы данных при инициализации приложения.

### DependencyInjection

**Описание**: Класс, содержащий методы расширения для настройки инфраструктурных сервисов.

**Методы**:
- `AddInfrastructureServices`: Добавляет инфраструктурные сервисы в коллекцию сервисов.

### Глобальные директивы using

**Описание**: Глобально подключает пространства имен `Microsoft.EntityFrameworkCore`, `Domain.Model`, и другие, позволяя использовать их без явного указания директивы using в каждом файле.

## Слой Application <a name="application  "></a>

### IApplicationDbContext

**Описание**: Интерфейс, представляющий контекст базы данных приложения.

**Методы**:
- `SaveChangesAsync`: Сохраняет изменения в базе данных асинхронно.

### CreateTopicDto

**Описание**: DTO модель для создания новой темы.

### LocationDto

**Описание**: DTO модель для для представления местоположения.

### TopicResponseDto

**Описание**: DTO модель для возвращения данных о теме.

### UpdateTopicDto

**Описание**: DTO модель для обновления данных в существующей теме.

### NotFoundException

**Описание**: Кастомное исключение сигнализирующее об отсутствии данных.

### TopicNotFoundException

**Описание**: Кастомное исключение сигнализирующее об отсутствии темы с определенным идентификатором, наследуется от `NotFoundException`.

### TopicExtensions

**Описание**:  Статический класс, предоставляющий методы расширения для преобразования доменных моделей Topic в DTO.

**Методы**:
- `ToTopicResponseDto`: Преобразует объект доменной модели `Topic` в `TopicResponseDto` для ответа API.
- `ToTopicResponseDtoList`: Преобразует объект доменной модели `Topic` в `List<TopicResponseDto>` для ответа AP.

### MappingProfile

**Описание**:  Класс конфигурации AutoMapper, определяющий правила преобразования между DTO и доменными моделями.

### IdentityUserResponseDto

**Описание**: DTO модель для передачи данных о пользователе после успешной аутентификации или регистрации.

### LoginRequestDto

**Описание**: DTO модель  для передачи данных аутентификации пользователя.

### RegisterUserRequestDto

**Описание**: DTO модель для передачи данных при регистрации нового пользователя.

### NotValidDataException

**Описание**: Кастомное исключение сигнализирующее о невалидности данных.

### NotValidEmailException

**Описание**: Кастомное исключение сигнализирующее о невалидности почты.

### NotValidPassException

**Описание**: Кастомное исключение сигнализирующее о невалидности пароля.

### NotValidUsernameException

**Описание**: Кастомное исключение сигнализирующее о невалидности пользовательского имени.

### CustomIdentityUserExtensions

**Описание**: Класс расширений для `CustomIdentityUser`.

**Методы**:
- `ToIdentityUserResponseDto`: Преобразует пользователя в DTO ответа.

### IJwtSecurityService

**Описание**: Интерфейс сервиса для генерации JWT-токенов аутентификации. Определяет контракт для создания токенов на основе пользовательских данных.

**Методы**:
- `CreateToken`: Создает JWT токен для пользователя.

### JwtSecurityService

**Описание**: Сервис для работы с JWT токенами, представляет реализацию контракта `IJwtSecurityService`.

**Методы**:
- `CreateToken`: Создает JWT токен для пользователя.

### RegisterUserHandler

**Описание**: Обработчик команды регистрации пользователя.

**Методы**:
- `Handle`: Обрабатывает команду регистрации пользователя.

### LoginUserHandler

**Описание**: Обработчик запроса входа пользователя.

**Методы**:
- `Handle`: Обрабатывает запрос входа пользователя.

### CreateTopicHandler

**Описание**: Обработчик команды создания темы.

**Методы**:
- `Handle`: Обрабатывает команду создания темы.

### DeleteTopicHandler

**Описание**: Обработчик команды удаления темы.

**Методы**:
- `Handle`: Обрабатывает команду удаления темы.

### UpdateTopicHandler

**Описание**: Обработчик команды обновления темы.

**Методы**:
- `Handle`: Обрабатывает команду обновления темы.

### GetTopicHandler

**Описание**: Обработчик запроса получения темы.

**Методы**:
- `Handle`: Обрабатывает запрос получения темы.

### GetTopicsHandler

**Описание**: Обработчик запроса получения списка тем.

**Методы**:
- `Handle`: Обрабатывает запрос получения списка тем.

### ITopicsService (устаревший)

**Описание**: Устаревший интерфейс сервиса для работы с темами, помеченный атрибутом [Obsolete]. Предоставляет базовые CRUD-операции для управления темами.

**Методы**:
- `GetTopicsAsync`: Получение всех тем.
- `GetTopicAsync`: Получение темы по ID.
- `CreateTopicAsync`: Создание новой темы.
- `UpdateTopicAsync`: Обновление темы.
- `DeleteTopicAsync`: Удаление темы.

### TopicsService (устаревший)

**Описание**: Это устаревшая ([Obsolete]) реализация сервиса для работы с темами, предоставляющая базовые CRUD-операции.

**Методы**:
- `GetTopicsAsync`: Получение всех тем.
- `GetTopicAsync`: Получение темы по ID.
- `CreateTopicAsync`: Создание новой темы.
- `UpdateTopicAsync`: Обновление темы.
- `DeleteTopicAsync`: Удаление темы.

### DependencyInjection

**Описание**: Класс, содержащий методы расширения для настройки сервисов приложения.

**Методы**:
- `AddApplicationServices`: Добавляет сервисы приложения в коллекцию сервисов.

### Глобальные директивы using

**Описание**: Глобально подключает пространства имен `Application.Dtos`, `Application.Exceptions`, `Application.Extensions`, и другие, позволяя использовать их без явного указания директивы using в каждом файле.

## Слой API <a name="api "></a>

### AuthController

**Описание**: Контроллер для аутентификации пользователей.

**Методы**:
- `Login`: Выполняет вход пользователя.
- `Register`: Регистрирует нового пользователя.

### TopicsController

**Описание**: Контроллер для управления темами.

**Методы**:
- `GetTopics`: Получает список всех тем.
- `GetTopic`: Получает тему по идентификатору.
- `CreateTopic`: Создает новую тему.
- `UpdateTopic`: Обновляет существующую тему.
- `DeleteTopic`: Удаляет тему.

### CustomExceptionHandler

**Описание**: Обработчик исключений для API.

**Методы**:
- `TryHandleAsync`: Обрабатывает исключения и возвращает соответствующий HTTP ответ.

### IdentityOptionExtension

**Описание**: Класс расширений для настройки сервисов идентификации.

**Методы**:
- `AddIdentityServices`: Добавляет сервисы идентификации в коллекцию сервисов.

### DependencyInjection

**Описание**: Класс, содержащий методы расширения для настройки API сервисов.

**Методы**:
- `AddApiServices`: Добавляет API сервисы в коллекцию сервисов.
- `UseApiServices`: Настраивает middleware для приложения.

### Program

**Описание**: Основной файл программы, который настраивает и запускает приложение ASP.NET Core.

**Методы**:
- `Main`: Основная точка входа в приложение, где настраиваются сервисы и конфигурация приложения.

### Глобальные директивы using 

**Описание**: Глобально подключает пространства имен `Microsoft.AspNetCore.Mvc`, `Api.Controllers`, и другие, позволяя использовать их без явного указания директивы using в каждом файле.

